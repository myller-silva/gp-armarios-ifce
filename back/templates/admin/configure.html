{% extends "base.html" %}

{% block title %}Configuração de Banco de Dados{% endblock %}
{% block title_navbar %}Configuração de Banco de Dados{% endblock %}

{% block content %}
<h2>Configurar Sistema</h2>
<form id="json-upload-form" method="POST" enctype="multipart/form-data">
    <label for="json_file">Selecionar Arquivo JSON:</label>
    <input type="file" name="json_file" id="json_file" required>
    <button type="submit">Enviar</button>
</form>

<!-- Exibir mensagens de sucesso ou erro -->
<div id="flash-message" style="margin-top: 10px;"></div>

<script>
    document.getElementById('json-upload-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Evita o reload da página

        const formData = new FormData(this);

        fetch("{{ url_for('admin.configure') }}", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const messageDiv = document.getElementById('flash-message');
            messageDiv.innerText = data.message;
            messageDiv.style.color = data.status === 'success' ? 'green' : 'red';
        })
        .catch(error => {
            console.error("Erro:", error);
            const messageDiv = document.getElementById('flash-message');
            messageDiv.innerText = "Erro ao enviar o arquivo.";
            messageDiv.style.color = "red";
        });
    });
</script>
{% endblock %}
